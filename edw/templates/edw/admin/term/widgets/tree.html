{% load i18n pipeline compress %}{% stylesheet 'term_admin' %}
{% compress js %}
<script type="text/javascript">
    "use strict";

    $(function(){
        var spinners = {};

        var $tree = $('#{{ name }}-select').tree({
            autoEscape: false,
            selectable: false,
            onCreateLi: function(node, $li){
                var $checkbox = $("input:checkbox", $li);
                $checkbox.change(node, function(e){
                    e.data._cheked = $(this).is(':checked');
                });
                if ( node._cheked ){
                    $checkbox.prop('checked', true);
                }
            },
            onLoading: function (is_loading, node, $el){

                function getNodeId() {
                    if (!node) {
                        return "__root__";
                    }
                    else {
                        return node.id;
                    }
                }

                function getContainer() {
                    if (node) {
                        return $el.find(".jqtree-element")[0];
                    }
                    else {
                        return $el[0];
                    }
                }

                var node_id = getNodeId();

                if (is_loading) {
                    spinners[node_id] = new Spinner().spin(getContainer());
                }
                else {
                    var spinner = spinners[node_id];
                    if (spinner) {
                        spinner.stop();
                        spinners[node_id] = null;
                    }
                }
            }
        }).bind(
            'tree.init',
            function(){
                $("input:checkbox[autoopen]", this).each(function(){
                    var node = $tree.tree('getNodeById', $(this).val());
                    $tree.tree('openNode', node, false);
                });
            }
        );
    });
</script>
{% endcompress %}
<div id="{{ name }}-select" data-url="{% url 'admin:edw_term_select_json' %}?name={{ name }}&selected={% for val in value %}{{ val|add:'0' }}{% if not forloop.last %},{% endif %}{% endfor %}&cached=0&active_only=0&_={% now 'U' %}" class="tree-widget"></div>